(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{115:function(e,t,n){"use strict";n.r(t);var a=n(38),r=n.n(a),s=n(129),c=(n(94),n(10)),o=n(9),i=n.n(o),l=n(5),u=n(17),p=n(18),d=n(24),m=n(23),f=n(25),h=n(1),y=n.n(h),b=n(4),v=n(8),g=n(109),w=n(126),x=n(122),O=function(e){return x.a.setItem("swarmchat:swarm_url",e)},k=function(e){return"".concat("swarmchat:").concat(e,":data")},E=function(){var e=Object(l.a)(i.a.mark(function e(t){var n,a;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n={},e.prev=1,e.next=4,x.a.getItem(k(t));case 4:null!=(a=e.sent)&&(n=JSON.parse(a)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),console.warn(e.t0);case 11:return e.abrupt("return",n);case 12:case"end":return e.stop()}},e,this,[[1,8]])}));return function(t){return e.apply(this,arguments)}}(),S=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return x.a.setItem(k(e),JSON.stringify(t))},C=n(34),j=n(49),_=n(123),R=n(124),T=function(e,t){return Object(j.encodeHex)(JSON.stringify(function(e){return{type:e,payload:arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},utc_timestamp:Date.now()}}(e,t)))},M=function(e){return{key:e.Key,data:JSON.parse(Object(j.decodeHex)(e.Msg))}},I=function(){function e(t){Object(u.a)(this,e),this._client=new j.SwarmClient({pss:t})}var t,n,a,r,s,o;return Object(p.a)(e,[{key:"getOwnInfo",value:(o=Object(l.a)(i.a.mark(function e(){var t,n,a,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=this._ownInfo){e.next=8;break}return e.next=3,Promise.all([this._client.pss.getPublicKey(),this._client.pss.baseAddr()]);case 3:t=e.sent,n=Object(C.a)(t,2),a=n[0],r=n[1],this._ownInfo={publicKey:a,overlayAddress:r};case 8:return e.abrupt("return",this._ownInfo);case 9:case"end":return e.stop()}},e,this)})),function(){return o.apply(this,arguments)})},{key:"createChatSubscription",value:(s=Object(l.a)(i.a.mark(function e(t,n){var a,r,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all([this._client.pss.createTopicSubscription(n),this._client.pss.setPeerPublicKey(t,n)]);case 2:return a=e.sent,r=Object(C.a)(a,1),s=r[0],e.abrupt("return",s.pipe(Object(_.a)(M),Object(R.a)(function(e){return"chat_message"===e.data.type&&null!=e.data.payload}),Object(_.a)(function(e){return{key:e.key,type:e.data.type,utc_timestamp:e.data.utc_timestamp,payload:e.data.payload}})));case 6:case"end":return e.stop()}},e,this)})),function(e,t){return s.apply(this,arguments)})},{key:"createContactSubscription",value:(r=Object(l.a)(i.a.mark(function e(){var t,n,a,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.getOwnInfo();case 2:return t=e.sent,n=t.publicKey,e.next=6,this._client.pss.stringToTopic(n);case 6:return a=e.sent,e.next=9,this._client.pss.createTopicSubscription(a);case 9:return r=e.sent,e.abrupt("return",r.pipe(Object(_.a)(M),Object(R.a)(function(e){return"contact_request"===e.data.type&&null!=e.data.payload&&null!=e.data.payload.topic||"contact_response"===e.data.type}),Object(_.a)(function(e){return{key:e.key,type:e.data.type,payload:e.data.payload}})));case 11:case"end":return e.stop()}},e,this)})),function(){return r.apply(this,arguments)})},{key:"sendChatMessage",value:(a=Object(l.a)(i.a.mark(function e(t,n,a){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return r=T("chat_message",a),e.next=3,this._client.pss.sendAsym(t,n,r);case 3:case"end":return e.stop()}},e,this)})),function(e,t,n){return a.apply(this,arguments)})},{key:"sendContactRequest",value:(n=Object(l.a)(i.a.mark(function e(t){var n,a,r,s,o,l,u,p=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=p.length>1&&void 0!==p[1]?p[1]:{},e.next=3,Promise.all([this.getOwnInfo(),this._client.pss.stringToTopic(t),this._client.pss.stringToTopic(Math.random().toString(36).slice(2))]);case 3:return a=e.sent,r=Object(C.a)(a,3),s=r[0],o=r[1],l=r[2],e.next=10,this._client.pss.setPeerPublicKey(t,o);case 10:return u=T("contact_request",Object(c.a)({},n,{topic:l,overlay_address:s.overlayAddress})),e.next=13,this._client.pss.sendAsym(t,o,u);case 13:return e.abrupt("return",l);case 14:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"sendContactResponse",value:(t=Object(l.a)(i.a.mark(function e(t,n){var a,r,s,c,o,l=arguments;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(a=l.length>2&&void 0!==l[2]?l[2]:{},!n){e.next=8;break}return e.next=4,this.getOwnInfo();case 4:s=e.sent,r={contact:!0,overlay_address:s.overlayAddress,username:a.username},e.next=9;break;case 8:r={contact:!1};case 9:return e.next=11,this._client.pss.stringToTopic(t);case 11:return c=e.sent,e.next=14,this._client.pss.setPeerPublicKey(t,c);case 14:return o=T("contact_response",r),e.next=17,this._client.pss.sendAsym(t,c,o);case 17:case"end":return e.stop()}},e,this)})),function(e,n){return t.apply(this,arguments)})},{key:"hasOwnInfo",get:function(){return null!=this._ownInfo}}]),e}(),K=n(57),V=n(21),P=n(63),A=n(55),D=n.n(A),q=n(113),B=n(64),z=n.n(B),U={"xx-large":160,"x-large":80,large:48,small:32},H=b.a.create({container:{overflow:"hidden",borderRadius:"50%",position:"relative"}}),L=function(e){var t=e.publicKey,n=e.size,a=U[n||"small"]||U.small;return y.a.createElement(v.a,{style:[H.container,{width:a,height:a}]},y.a.createElement(z.a,{seed:t,size:8,scale:Math.ceil(a/8)}))},J=n(128),N=n(78),Y=n(125),W="#337ab7",G="#ff8c00",F="#ffffff",$="#333333",Q="#ff8c00",X="#337ab7",Z="#ffffff",ee="#d72323",te=b.a.create({viewCenter:{flex:1,alignItems:"center",justifyContent:"center"}}),ne=b.a.create({input:{borderWidth:1,borderColor:W,padding:5,marginBottom:5,borderRadius:2}}),ae=Object(h.forwardRef)(function(e,t){var n=e.style,a=Object(N.a)(e,["style"]);return y.a.createElement(Y.a,Object.assign({ref:t,style:[ne.input,n]},a))}),re=b.a.create({chatView:{flex:1,flexDirection:"column"},chatMessagesView:{flex:1},chatSendView:{backgroundColor:$,flexDirection:"row",paddingTop:5},chatInput:{backgroundColor:F,padding:7},chatSendInputView:{flex:1},chatSendButtonView:{paddingHorizontal:5},messageView:{padding:3},messageSenderText:{fontWeight:"bold"},textView:{paddingVertical:5},actionText:{color:X}}),se=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(d.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).inputRef=Object(h.createRef)(),n.messagesViewRef=Object(h.createRef)(),n.state={messageText:"",scrollToEnd:!0},n.onScroll=function(){n.setState({scrollToEnd:n.isScrolledToEnd})},n.onChangeMessage=function(e){n.setState({messageText:e})},n.onSubmitMessage=function(){var e=n.state.messageText;0!==e.length&&(n.props.onSendChatMessage(n.props.contact.key,e),n.setState({messageText:"",scrollToEnd:!0},function(){null!=n.inputRef.current&&n.inputRef.current.focus()}))},n}return Object(f.a)(t,e),Object(p.a)(t,[{key:"componentDidMount",value:function(){null!=this.messagesViewRef.current&&this.messagesViewRef.current.scrollToEnd({animated:!1})}},{key:"componentDidUpdate",value:function(){var e=this;this.state.scrollToEnd&&setTimeout(function(){null!=e.messagesViewRef.current&&e.messagesViewRef.current.scrollToEnd()},0)}},{key:"render",value:function(){var e=this.props,t=e.chat,n=e.contact,a=e.onAcceptContact,r=e.onDeclineContact,s=e.onResendContactRequest,c=this.state.messageText,o=null;switch(null!=t&&t.messages.length&&(o=t.messages.map(function(e){var t=e.sender===n.key?n.username||n.key.slice(0,8):"You";return y.a.createElement(v.a,{key:e.id,style:re.messageView},y.a.createElement(g.a,null,y.a.createElement(g.a,{style:re.messageSenderText},t,": "),y.a.createElement(g.a,null,e.text)))})),n.type){case"added":return y.a.createElement(v.a,{style:re.chatView},y.a.createElement(J.a,{onScroll:this.onScroll,ref:this.messagesViewRef,style:re.chatMessagesView},o),y.a.createElement(v.a,{style:re.chatSendView},y.a.createElement(v.a,{style:re.chatSendInputView},y.a.createElement(ae,{autoFocus:!0,onChangeText:this.onChangeMessage,onSubmitEditing:this.onSubmitMessage,ref:this.inputRef,style:re.chatInput,value:c})),y.a.createElement(v.a,{style:re.chatSendButtonView},y.a.createElement(w.a,{disabled:0===c.length,color:G,onPress:this.onSubmitMessage,title:"Send"}))));case"received_declined":return y.a.createElement(v.a,{style:te.viewCenter},y.a.createElement(v.a,{style:re.textView},y.a.createElement(g.a,null,"You have declined this invitation.")),y.a.createElement(w.a,{color:Q,onPress:a,title:"Accept invitation"}));case"received_pending":return y.a.createElement(v.a,{style:te.viewCenter},y.a.createElement(w.a,{color:Q,onPress:a,title:"Accept invitation"}),y.a.createElement(v.a,{style:re.textView},y.a.createElement(g.a,{onPress:r,style:re.actionText},"or decline it")));case"sent_declined":return y.a.createElement(v.a,{style:te.viewCenter},y.a.createElement(v.a,{style:re.textView},y.a.createElement(g.a,null,"Invitation declined by contact.")),y.a.createElement(v.a,{style:re.textView},y.a.createElement(g.a,null,"You think it is by mistake?\xa0",y.a.createElement(g.a,{onPress:s,style:re.actionText},"Send the invitation again."))));case"sent_pending":return y.a.createElement(v.a,{style:te.viewCenter},y.a.createElement(v.a,{style:re.textView},y.a.createElement(g.a,null,"Invite sent")),y.a.createElement(w.a,{color:Q,onPress:s,title:"Send again"}));default:return null}}},{key:"isScrolledToEnd",get:function(){if(null==this.messagesViewRef.current)return!1;var e=this.messagesViewRef.current.getScrollableNode(),t=e.getBoundingClientRect(),n=this.messagesViewRef.current.getInnerViewNode().getBoundingClientRect();return t.height+e.scrollTop===n.height}}]),t}(h.PureComponent),ce=n(114),oe=b.a.create({root:{flex:1},titleView:{padding:5},titleText:{color:Z,fontSize:20},group:{paddingLeft:5,marginBottom:5},groupTitleView:{padding:5},groupTitleText:{color:Z,fontSize:16},contactItem:{flexDirection:"row",borderBottomLeftRadius:20,borderTopLeftRadius:20,padding:2},contactItemText:{color:Z,lineHeight:32},contactItemSelected:{backgroundColor:F},contactItemSelectedText:{color:X},inviteButtonView:{padding:5}}),ie=function(e){function t(){return Object(u.a)(this,t),Object(d.a)(this,Object(m.a)(t).apply(this,arguments))}return Object(f.a)(t,e),Object(p.a)(t,[{key:"renderGroup",value:function(e,t){if(0===t.length)return null;var n=this.props,a=n.onSelectKey,r=n.selectedKey,s=t.map(function(e){var t=r===e.key;return y.a.createElement(ce.a,{key:e.key,onPress:function(){return a(e.key)}},y.a.createElement(v.a,{style:[oe.contactItem,t&&oe.contactItemSelected]},y.a.createElement(L,{publicKey:e.key,size:"small"}),y.a.createElement(g.a,{numberOfLines:1,style:[oe.contactItemText,t&&oe.contactItemSelectedText]},"\xa0",e.username||e.key)))});return y.a.createElement(v.a,{style:oe.group},y.a.createElement(v.a,{style:oe.groupTitleView},y.a.createElement(g.a,{style:oe.groupTitleText},e)),s)}},{key:"render",value:function(){var e=this.props,t=e.contacts,n=e.onOpenInviteModal,a=Object.values(t),r=null;if(a.length>0){var s={added:[],received:[],sent:[]};a.forEach(function(e){var t=s[e.type.split("_")[0]];null==t?console.warn("Invalid contact type",e):t.push(e)}),r=y.a.createElement(h.Fragment,null,this.renderGroup("Added",s.added),this.renderGroup("Received",s.received),this.renderGroup("Sent",s.sent))}return y.a.createElement(J.a,{style:oe.root},y.a.createElement(v.a,{style:oe.titleView},y.a.createElement(g.a,{style:oe.titleText},"Contacts")),r,y.a.createElement(v.a,{style:oe.inviteButtonView},y.a.createElement(w.a,{color:W,onPress:n,title:"Add contact"})))}}]),t}(h.PureComponent),le=b.a.create({view:{marginBottom:5},text:{color:ee,fontWeight:"bold"}}),ue=function(e){var t=e.message;return t?y.a.createElement(v.a,{style:le.view},y.a.createElement(g.a,{style:le.text},t)):null},pe=n(127),de=function(){return y.a.createElement(v.a,{style:te.viewCenter},y.a.createElement(pe.a,{color:W,size:"large"}))},me=/^0x[0-9a-f]{130}$/,fe=b.a.create({root:{flex:1,flexDirection:"row"},sidebar:{width:200,flexDirection:"column",backgroundColor:$},sidebarHeader:{padding:5,flexDirection:"row"},sidebarHeaderText:{fontSize:18,lineHeight:48,color:Z,textAlign:"center"},content:{flex:1,flexDirection:"column"},modalSection:{paddingVertical:5},spacer:{height:10}}),he={chats:{},contactKey:"",contacts:{},inviteErrorMessage:void 0,inviteModalOpen:!1,publicKey:void 0,selectedKey:void 0,settingsModalOpen:!1,username:""},ye=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(d.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r))))._chatSubs={},n.state=he,n.createChatSubscriptions=Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,Promise.all(Object.values(n.state.contacts).filter(function(e){return"added"===e.type}).map(n.createChatSubscription));case 2:case"end":return e.stop()}},e,this)})),n.createChatSubscription=function(){var e=Object(l.a)(i.a.mark(function e(t){var a,r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.client.createChatSubscription(t.key,t.topic);case 2:return a=e.sent,r=a.subscribe(n.onReceiveChatEvent),n._chatSubs[t.key]=r,e.abrupt("return",r);case 6:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}(),n.onResetAppData=function(){var e=n.state.publicKey;n.setState(Object(c.a)({},he,{publicKey:e}),function(){S(e)})},n.onReceiveChatEvent=function(e){n.setState(function(t){var n=t.chats,a=D()(e),r=n[e.key];return null==r?{chats:Object(c.a)({},n,Object(V.a)({},e.key,{messages:[{id:a,sender:e.key,text:e.payload.text,timestamp:e.utc_timestamp}],pointer:0}))}:r.messages.some(function(e){return e.id===a})?(console.warn("duplicate message",e),null):{chats:Object(c.a)({},n,Object(V.a)({},e.key,Object(c.a)({},r,{messages:Object(K.a)(r.messages).concat([{id:a,sender:e.key,text:e.payload.text,timestamp:e.utc_timestamp}])})))}})},n.onReceiveContactEvent=function(e){var t;n.setState(function(n){var a=n.contacts,r=a[e.key];if("contact_request"===e.type&&(null==r||"received_pending"===r.type))return{contacts:Object(c.a)({},a,Object(V.a)({},e.key,{key:e.key,type:"received_pending",topic:e.payload.topic,username:e.payload.username,address:e.payload.overlay_address}))};if("contact_response"===e.type&&null!=r&&("sent_declined"===r.type||"sent_pending"===r.type)){var s=Object(c.a)({},r,{type:!0===e.payload.contact?"added":"sent_declined",username:e.payload.username,address:e.payload.overlay_address});return"added"===s.type&&(t=s),{contacts:Object(c.a)({},a,Object(V.a)({},e.key,s))}}return null},Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==t){e.next=3;break}return e.next=3,n.createChatSubscription(t);case 3:case"end":return e.stop()}},e,this)})))},n.onChangeContactKey=function(e){n.setState({contactKey:e})},n.onChangeUsername=function(e){n.setState({username:e})},n.onSendChatMessage=function(){var e=Object(l.a)(i.a.mark(function e(t,a){var r;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null!=(r=n.state.contacts[t])){e.next=3;break}throw new Error("Unknown contact");case 3:if("added"===r.type){e.next=5;break}throw new Error("Cannot send message until contact is added");case 5:if(null!=n._chatSubs[t]){e.next=7;break}throw new Error("Chat subscription does not exist");case 7:return e.next=9,n.props.client.sendChatMessage(t,r.topic,{text:a});case 9:n.setState(function(e){var n=e.chats,r=e.publicKey,s=n[t]||{messages:[],pointer:0},o={id:void 0,sender:r,text:a,timestamp:Date.now()};return o.id=D()(o),{chats:Object(c.a)({},n,Object(V.a)({},t,Object(c.a)({},s,{messages:Object(K.a)(s.messages).concat([o])})))}});case 10:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),n.onSubmitContactRequest=Object(l.a)(i.a.mark(function e(){var t,a,r,s,o,l;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.state,a=t.contactKey,r=t.publicKey,s=t.username,0!==a.length){e.next=3;break}return e.abrupt("return");case 3:if(a!==r){e.next=7;break}n.setState({inviteErrorMessage:"Invalid contact key: this is your own key"}),e.next=17;break;case 7:if(me.test(a)){e.next=11;break}n.setState({inviteErrorMessage:'Invalid contact key: must be an hexadecimal string prefixed with "0x"'}),e.next=17;break;case 11:return n.setState({inviteModalOpen:!1}),o=s.length>0?{username:s}:void 0,e.next=15,n.props.client.sendContactRequest(Object(P.a)(a),o);case 15:l=e.sent,n.setState(function(e){var t=e.contacts;return{contactKey:"",contacts:Object(c.a)({},t,Object(V.a)({},a,{key:a,type:"sent_pending",topic:l}))}});case 17:case"end":return e.stop()}},e,this)})),n.sendContactResponse=function(){var e=Object(l.a)(i.a.mark(function e(t,a){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,n.props.client.sendContactResponse(t,a,{username:n.state.username});case 2:n.setState(function(e){var n=e.contacts,r=n[t];return{contacts:Object(c.a)({},n,Object(V.a)({},t,Object(c.a)({},r,{type:a?"added":"received_declined"})))}},Object(l.a)(i.a.mark(function e(){return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!a){e.next=3;break}return e.next=3,n.createChatSubscription(n.state.contacts[t]);case 3:case"end":return e.stop()}},e,this)})));case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}(),n.onOpenInviteModal=function(){n.setState({inviteModalOpen:!0})},n.onCloseInviteModal=function(){n.setState({inviteModalOpen:!1})},n.onOpenSettingsModal=function(){n.setState({settingsModalOpen:!0})},n.onCloseSettingsModal=function(){n.setState({settingsModalOpen:!1})},n.onSelectKey=function(e){n.setState({selectedKey:e})},n.onAcceptContact=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=n.state.selectedKey)){e.next=4;break}return e.next=4,n.sendContactResponse(t,!0);case 4:case"end":return e.stop()}},e,this)})),n.onDeclineContact=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(null==(t=n.state.selectedKey)){e.next=4;break}return e.next=4,n.sendContactResponse(t,!1);case 4:case"end":return e.stop()}},e,this)})),n.onResendContactRequest=Object(l.a)(i.a.mark(function e(){var t,a,r,s;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=n.state,a=t.selectedKey,r=t.username,null==a){e.next=5;break}return s=r?{username:r}:void 0,e.next=5,n.props.client.sendContactRequest(a,s);case 5:case"end":return e.stop()}},e,this)})),n}var n,a;return Object(f.a)(t,e),Object(p.a)(t,[{key:"setup",value:(a=Object(l.a)(i.a.mark(function e(){var t,n,a,r,s,o,l,u=this;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t=this.props.client,e.next=3,t.getOwnInfo();case 3:return n=e.sent,a=n.publicKey,e.next=7,Promise.all([E(a),t.createContactSubscription()]);case 7:r=e.sent,s=Object(C.a)(r,2),o=s[0],l=s[1],this.setState(Object(c.a)({},o,{publicKey:a}),function(){u._contactSub=l.subscribe(u.onReceiveContactEvent),u.createChatSubscriptions()});case 12:case"end":return e.stop()}},e,this)})),function(){return a.apply(this,arguments)})},{key:"saveAppData",value:(n=Object(l.a)(i.a.mark(function e(){var t,n,a,r,s,c;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(t=this.state,n=t.chats,a=t.contacts,r=t.publicKey,s=t.selectedKey,c=t.username,null!=r){e.next=5;break}console.warn("Cannot save app data before public key is known"),e.next=13;break;case 5:return e.prev=5,e.next=8,S(r,{chats:n,contacts:a,selectedKey:s,username:c});case 8:e.next=13;break;case 10:e.prev=10,e.t0=e.catch(5),console.warn(e.t0);case 13:case"end":return e.stop()}},e,this,[[5,10]])})),function(){return n.apply(this,arguments)})},{key:"componentDidMount",value:function(){this.setup()}},{key:"componentDidUpdate",value:function(){this.saveAppData()}},{key:"componentWillUnmount",value:function(){Object.values(this._chatSubs).map(function(e){return e.unsubscribe()}),null!=this._contactSub&&this._contactSub.unsubscribe()}},{key:"render",value:function(){var e=this.props.onDisconnect,t=this.state,n=t.chats,a=t.contactKey,s=t.contacts,c=t.inviteErrorMessage,o=t.inviteModalOpen,i=t.publicKey,l=t.selectedKey,u=t.settingsModalOpen,p=t.username;if(null==i)return y.a.createElement(de,null);var d=null;if(null!=l){var m=l;d=y.a.createElement(se,{chat:n[m],contact:s[m],onAcceptContact:this.onAcceptContact,onDeclineContact:this.onDeclineContact,onResendContactRequest:this.onResendContactRequest,onSendChatMessage:this.onSendChatMessage})}return y.a.createElement(v.a,{style:fe.root},y.a.createElement(v.a,{style:fe.sidebar},y.a.createElement(q.a,{onPress:this.onOpenSettingsModal,style:fe.sidebarHeader},y.a.createElement(L,{publicKey:i,size:"large"}),y.a.createElement(g.a,{numberOfLines:1,style:fe.sidebarHeaderText},"\xa0",p||i)),y.a.createElement(ie,{contacts:s,onOpenInviteModal:this.onOpenInviteModal,onSelectKey:this.onSelectKey,selectedKey:l})),y.a.createElement(v.a,{style:fe.content},d),y.a.createElement(r.a,{isOpen:o,onRequestClose:this.onCloseInviteModal},y.a.createElement(ue,{message:c}),y.a.createElement(v.a,null,y.a.createElement(g.a,null,"Contact public key:"),y.a.createElement(ae,{onChangeText:this.onChangeContactKey,onSubmitEditing:this.onSubmitContactRequest,value:a})),y.a.createElement(v.a,null,y.a.createElement(g.a,null,"Your username (optional):"),y.a.createElement(ae,{onChangeText:this.onChangeUsername,onSubmitEditing:this.onSubmitContactRequest,value:p})),y.a.createElement(w.a,{color:Q,disabled:0===a.length,onPress:this.onSubmitContactRequest,title:"Invite contact"})),y.a.createElement(r.a,{isOpen:u,onRequestClose:this.onCloseSettingsModal},y.a.createElement(v.a,{style:fe.modalSection},y.a.createElement(g.a,null,"Your public key: ",i)),y.a.createElement(v.a,{style:fe.modalSection},y.a.createElement(g.a,null,"Your username (optional):"),y.a.createElement(ae,{onChangeText:this.onChangeUsername,value:p})),y.a.createElement(w.a,{color:Q,onPress:this.onCloseSettingsModal,title:"Close"}),y.a.createElement(v.a,{style:fe.spacer}),y.a.createElement(w.a,{color:W,onPress:this.onResetAppData,title:"Reset application data"}),y.a.createElement(v.a,{style:fe.spacer}),y.a.createElement(w.a,{color:W,onPress:e,title:"Disconnect from Swarm node"})))}}]),t}(h.Component),be=b.a.create({root:{backgroundColor:$},form:{alignSelf:"center",backgroundColor:F,width:400,padding:10,borderRadius:10},title:{color:Z,fontSize:32}}),ve={client:void 0,errorMessage:void 0,step:"setup",url:"ws://localhost:8546"},ge=function(e){function t(){var e,n;Object(u.a)(this,t);for(var a=arguments.length,r=new Array(a),s=0;s<a;s++)r[s]=arguments[s];return(n=Object(d.a)(this,(e=Object(m.a)(t)).call.apply(e,[this].concat(r)))).state=ve,n.onChangeURL=function(e){n.setState({url:e})},n.onSubmit=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if(!((t=n.state.url).length>0)){e.next=8;break}return e.next=4,n.createClient(t);case 4:if(!e.sent){e.next=8;break}return e.next=8,O(t);case 8:case"end":return e.stop()}},e,this)})),n.onReset=function(){n.setState(Object(c.a)({},ve,{step:"input_url",url:n.state.url}))},n}var n,a;return Object(f.a)(t,e),Object(p.a)(t,[{key:"createClient",value:(a=Object(l.a)(i.a.mark(function e(t){var n;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,n=new I(t),e.next=4,n.getOwnInfo();case 4:return this.setState({step:"ready",client:n}),e.abrupt("return",!0);case 8:return e.prev=8,e.t0=e.catch(0),this.setState({step:"setup_failed",errorMessage:e.t0.message,url:t}),e.abrupt("return",!1);case 12:case"end":return e.stop()}},e,this,[[0,8]])})),function(e){return a.apply(this,arguments)})},{key:"setup",value:(n=Object(l.a)(i.a.mark(function e(){var t;return i.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,x.a.getItem("swarmchat:swarm_url");case 2:if(null!=(t=e.sent)){e.next=7;break}this.setState({step:"input_url"}),e.next=9;break;case 7:return e.next=9,this.createClient(t);case 9:case"end":return e.stop()}},e,this)})),function(){return n.apply(this,arguments)})},{key:"componentDidMount",value:function(){this.setup()}},{key:"render",value:function(){var e=this.state,t=e.client,n=e.errorMessage,a=e.step,r=e.url;return"setup"===a?y.a.createElement(de,null):"ready"===a&&null!=t?y.a.createElement(ye,{client:t,onDisconnect:this.onReset}):y.a.createElement(v.a,{style:[te.viewCenter,be.root]},y.a.createElement(g.a,{style:be.title},"SwarmChat"),y.a.createElement(v.a,{style:be.form},"setup_failed"===a?y.a.createElement(ue,{message:n}):null,y.a.createElement(g.a,null,"Swarm WebSocket URL:"),y.a.createElement(ae,{onChangeText:this.onChangeURL,onSubmitEditing:this.onSubmit,value:r}),y.a.createElement(w.a,{color:Q,disabled:0===r.length,onPress:this.onSubmit,title:"Connect"})))}}]),t}(h.Component),we=document.getElementById("root");r.a.setAppElement(we),s.a.registerComponent("App",function(){return ge}),s.a.runApplication("App",{rootTag:we})},79:function(e,t,n){e.exports=n(115)},94:function(e,t,n){}},[[79,2,1]]]);
//# sourceMappingURL=main.ac396887.chunk.js.map